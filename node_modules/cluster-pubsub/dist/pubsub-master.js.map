{"version":3,"sources":["../src/pubsub-master.es6"],"names":[],"mappings":";;;;;;;;AAAA;;AACA;;AACA;;;;;;;;IAEM,Y;AACJ,wBAAY,EAAZ,EAA2B;AAAA,QAAX,IAAW,yDAAJ,EAAI;;AAAA;;AACzB,SAAK,IAAL,GAAY,IAAZ;;AAEA,SAAK,MAAL,GAAc,oBAAa,KAAK,KAAlB,CAAd;AACA,SAAK,GAAL,GAAW,oBAAY,EAAZ,EAAgB,IAAhB,CAAX;AACA,SAAK,KAAL,GAAa,KAAK,GAAL,CAAS,KAAtB;AACD;;;;2BAEM,M,EAAQ,O,EAAS,U,EAAY,E,EAAI;AAAA;;AACtC,WAAK,MAAL,GAAc,MAAd;;AAEA,WAAK,MAAL,CAAY,MAAZ,CAAmB,MAAnB;;AAEA,WAAK,GAAL,CAAS,EAAT,CAAY,WAAZ,EAAyB,UAAC,MAAD,EAAS,IAAT;AAAA,eAAkB,MAAK,MAAL,CAAY,MAAZ,CAAmB,MAAnB,EAA2B,KAAK,KAAhC,CAAlB;AAAA,OAAzB;AACA,WAAK,GAAL,CAAS,EAAT,CAAY,cAAZ,EAA4B,UAAC,MAAD,EAAS,IAAT;AAAA,eAAkB,MAAK,MAAL,CAAY,MAAZ,CAAmB,MAAnB,EAA2B,KAAK,KAAhC,CAAlB;AAAA,OAA5B;AACA,WAAK,GAAL,CAAS,EAAT,CAAY,WAAZ,EAAyB,UAAC,MAAD,EAAS,IAAT;AAAA,eAAkB,MAAK,MAAL,CAAY,SAAZ,CAAsB,MAAtB,EAA8B,KAAK,OAAnC,EAA4C,KAAK,IAAjD,CAAlB;AAAA,OAAzB;AACA,WAAK,GAAL,CAAS,EAAT,CAAY,MAAZ,EACY,UAAC,MAAD,EAAS,IAAT;AAAA,eAAkB,MAAK,MAAL,CAAY,IAAZ,CAAiB,MAAjB,EAAyB,KAAK,KAA9B,EAAqC,KAAK,OAA1C,EAAmD,KAAK,EAAxD,EAA4D,KAAK,IAAjE,EAAuE,KAAK,GAA5E,CAAlB;AAAA,OADZ;AAEA,WAAK,GAAL,CAAS,EAAT,CAAY,oBAAZ,EACY;AAAA,eAAU,uBAAQ,MAAR,EAAgB,MAAK,IAAL,CAAU,MAA1B,EAAkC,IAAlC,CAAuC;AAAA,iBAAK,MAAK,GAAL,CAAS,IAAT,CAAc,MAAd,EAAsB,gBAAtB,EAAwC,CAAxC,CAAL;AAAA,SAAvC,CAAV;AAAA,OADZ;;AAGA,WAAK,MAAL,CAAY,EAAZ,CAAe,iBAAf,EAAkC,UAAC,MAAD,EAAS,IAAT;AAAA,eAAkB,MAAK,GAAL,CAAS,IAAT,CAAc,MAAd,EAAsB,iBAAtB,EAAyC,IAAzC,CAAlB;AAAA,OAAlC;AACA,WAAK,MAAL,CAAY,EAAZ,CAAe,qBAAf,EAAsC,UAAC,MAAD,EAAS,IAAT;AAAA,eAAkB,MAAK,GAAL,CAAS,IAAT,CAAc,MAAd,EAAsB,qBAAtB,EAA6C,IAA7C,CAAlB;AAAA,OAAtC;AACA,WAAK,MAAL,CAAY,EAAZ,CAAe,aAAf,EAA8B,UAAC,MAAD,EAAS,IAAT;AAAA,eAAkB,MAAK,GAAL,CAAS,IAAT,CAAc,MAAd,EAAsB,aAAtB,EAAqC,IAArC,CAAlB;AAAA,OAA9B;AACA,WAAK,MAAL,CAAY,EAAZ,CAAe,eAAf,EAAgC,UAAC,MAAD,EAAS,IAAT;AAAA,eAAkB,MAAK,GAAL,CAAS,IAAT,CAAc,MAAd,EAAsB,eAAtB,EAAuC,IAAvC,CAAlB;AAAA,OAAhC;;AAEA,WAAK,GAAL,CAAS,MAAT,CAAgB,OAAhB,EAAyB;AAAA,eAAM,MAAK,MAAL,CAAY,MAAZ,CAAmB,UAAnB,EAA+B,EAA/B,CAAN;AAAA,OAAzB;AACD;;;;;;kBAGY,Y","file":"pubsub-master.es6","sourcesContent":["import {SocketIO} from './client-com/index.es6';\nimport {NodeIPC} from './ipc/index.es6';\nimport address from './libs/address.es6';\n\nclass PubSubMaster {\n  constructor(id, opts = {}) {\n    this.opts = opts;\n\n    this.client = new SocketIO(opts.debug);\n    this.ipc = new NodeIPC(id, opts);\n    this.Slave = this.ipc.Slave;\n  }\n\n  listen(server, ipcPort, clientPort, cb) {\n    this.server = server;\n\n    this.client.attach(server);\n\n    this.ipc.on('add-token', (origin, data) => this.client.accept(origin, data.token));\n    this.ipc.on('remove-token', (origin, data) => this.client.reject(origin, data.token));\n    this.ipc.on('broadcast', (origin, data) => this.client.broadcast(origin, data.channel, data.data));\n    this.ipc.on('emit',\n                (origin, data) => this.client.emit(origin, data.token, data.channel, data.id, data.data, data.awk));\n    this.ipc.on('get-server-address',\n                origin => address(server, this.opts.remote).then(a => this.ipc.emit(origin, 'server-address', a)));\n\n    this.client.on('client-received', (origin, data) => this.ipc.emit(origin, 'client-received', data));\n    this.client.on('client-disconnected', (origin, data) => this.ipc.emit(origin, 'client-disconnected', data));\n    this.client.on('token-added', (origin, data) => this.ipc.emit(origin, 'token-added', data));\n    this.client.on('token-removed', (origin, data) => this.ipc.emit(origin, 'token-removed', data));\n\n    this.ipc.listen(ipcPort, () => this.server.listen(clientPort, cb));\n  }\n}\n\nexport default PubSubMaster;\n"]}